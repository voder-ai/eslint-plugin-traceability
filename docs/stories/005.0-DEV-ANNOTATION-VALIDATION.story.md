# 005.0-DEV-ANNOTATION-VALIDATION: Annotation Format Validation

## Release Goal

_Release 0.1: Core Validation - Provide essential ESLint rules that enforce @story and @req annotations on functions and code branches_

This story implements validation logic that ensures @story and @req annotations follow proper format and syntax rules. It provides the foundation for validating annotation structure before checking file references and requirement existence, enabling clear error reporting for malformed annotations.

## How This Story Contributes

This story enables the "Validate Annotations" journey phase by ensuring annotation syntax is correct and parseable before attempting to validate file references. It provides immediate feedback on annotation format issues, improving developer experience by catching syntax errors early in the validation pipeline and enabling more sophisticated validation in later stories.

## User Story

**Format**: So that I can ensure my traceability annotations are properly formatted and parseable, as a Developer, I want validation that checks @story and @req annotation syntax and provides helpful error messages for format violations.

**INVEST Criteria Compliance**:

- **Independent**: Can be developed after annotation detection rules (depends on 001.0, 002.0, 003.0, 004.0)
- **Negotiable**: Format strictness and validation rules can be refined during implementation
- **Valuable**: Delivers clear feedback on annotation syntax before file validation
- **Estimable**: Scope is clear - annotation format validation with defined syntax rules
- **Small**: Can be completed within a single iteration/sprint
- **Testable**: Format validation can be thoroughly tested with various annotation patterns

## Acceptance Criteria

Use checkbox format for clear completion tracking:

- [ ] **Core Functionality**: Validates @story and @req annotation format and syntax
- [ ] **Quality Standards**: Follows ESLint development best practices for validation rules
- [ ] **Integration**: Works with annotations found by function and branch validation rules
- [ ] **User Experience**: Clear, specific error messages for different format violations
- [ ] **Error Handling**: Gracefully handles edge cases and malformed comment structures
- [ ] **Documentation**: Format specification with examples of valid and invalid annotations

## Requirements (Current Implementation or To Be Implemented)

Document specific technical requirements using the format:

- **REQ-FORMAT-SPECIFICATION**: Define clear format rules for @story and @req annotations
- **REQ-SYNTAX-VALIDATION**: Validate annotation syntax matches specification
- **REQ-PATH-FORMAT**: Validate @story paths follow expected patterns (relative paths, .story.md extension)
- **REQ-REQ-FORMAT**: Validate @req identifiers follow expected patterns (REQ-\* format)
- **REQ-MULTILINE-SUPPORT**: Handle annotations split across multiple lines
- **REQ-FLEXIBLE-PARSING**: Support reasonable variations in whitespace and formatting
- **REQ-ERROR-SPECIFICITY**: Provide specific error messages for different format violations

## Dependencies

List other stories this story depends on, using numbered story references:

- 001.0-DEV-PLUGIN-SETUP (requires plugin structure foundation)
- 002.0-DEV-ESLINT-CONFIG (requires configuration system)
- 003.0-DEV-FUNCTION-ANNOTATIONS (uses annotations detected by function validation)
- 004.0-DEV-BRANCH-ANNOTATIONS (uses annotations detected by branch validation)

**Dependency Rules**:

- Story numbers MUST be greater than all dependency story numbers
- Dependencies should be from in-scope stories when possible
- Cross-release dependencies should be clearly justified
- No circular dependencies allowed

## Implementation Notes (Optional)

Additional context for developers:

- Build shared validation utilities used by both function and branch annotation rules
- Define annotation format specification as part of plugin configuration
- Support configurable format strictness levels
- Implement regex patterns for common annotation formats
- Handle various JSDoc comment styles and formatting
- Provide clear error messages with suggestions for fixing format issues
- Consider allowing configuration of custom annotation formats

**Annotation Format Examples:**

Valid formats:

```javascript
/**
 * @story docs/stories/001.0-DEV-EXAMPLE.story.md
 * @req REQ-FUNCTION-VALIDATION
 */
function example() {}

// @story docs/stories/001.0-DEV-EXAMPLE.story.md
// @req REQ-BRANCH-LOGIC
if (condition) {
}
```

Invalid formats requiring validation:

```javascript
// @story missing-extension
// @req invalid-format

// @story ../../../outside-project.story.md  (path traversal)
// @req (missing identifier)

/**
 * @story
 * @req REQ-EXAMPLE
 */  (missing story path)
```

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Code reviewed and approved
- [ ] Tests written and passing (comprehensive format validation coverage)
- [ ] Documentation updated (annotation format specification and examples)
- [ ] Validation utilities integrated with existing annotation rules
- [ ] Performance tested with various annotation patterns
- [ ] Ready for file validation logic (006.0-DEV-FILE-VALIDATION)

---
