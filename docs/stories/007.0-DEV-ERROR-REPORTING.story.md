# 007.0-DEV-ERROR-REPORTING: Clear Error Messages for Annotation Violations

## Release Goal

**Release 0.1: Core Validation** - Provide essential ESLint rules that enforce @story and @req annotations on functions and code branches, with validation that referenced files exist and contain the referenced requirements.

This story ensures developers receive clear, actionable feedback when traceability violations are detected, enabling quick resolution of annotation issues and supporting the overall goal of reliable traceability enforcement.

## How This Story Contributes

Clear error messages are critical for developer adoption and productivity. When annotation validation fails, developers need to understand exactly what's wrong and how to fix it. This story transforms technical validation failures into helpful guidance, reducing friction in maintaining traceability annotations and ensuring developers can quickly resolve issues without extensive debugging.

This story enables successful completion of the "Fix Issues" journey phase by providing the foundation for all error communication in the plugin.

## User Story

**Format**: So that I can quickly understand and fix traceability violations without wasting time debugging, as a Developer, I want the ESLint plugin to provide clear, specific error messages that explain what's wrong and suggest how to fix annotation issues.

**INVEST Criteria Compliance**:

- **Independent**: Can be developed using the validation logic from previous stories without blocking dependencies
- **Negotiable**: Error message formats and content can be refined based on developer feedback during implementation
- **Valuable**: Delivers clear value by reducing time spent debugging annotation issues
- **Estimable**: Scope is well-defined - enhance existing validation rules with improved messaging
- **Small**: Focused on message enhancement rather than new validation logic
- **Testable**: Error messages can be verified through unit tests and developer feedback

## Acceptance Criteria

- [x] **Core Functionality**: All validation rules provide specific, actionable error messages instead of generic failures
- [x] **Quality Standards**: Error messages follow ESLint best practices for clarity and consistency
- [x] **Integration**: Error messages work properly with existing validation rules and ESLint reporting
- [x] **User Experience**: Messages clearly identify the problem, location, and suggested fix
- [x] **Error Handling**: Gracefully handles edge cases where error context is incomplete
- [x] **Documentation**: Error message formats are documented for consistency across rules

## Requirements (Current Implementation or To Be Implemented)

- **REQ-ERROR-SPECIFIC**: Each validation failure provides specific details about what annotation is missing or invalid
- **REQ-ERROR-LOCATION**: Error messages include precise location information (function name, line number, file path)
- **REQ-ERROR-SUGGESTION**: Messages suggest concrete steps to fix the issue (e.g., "Add @story annotation" or "Fix file path")
- **REQ-ERROR-CONTEXT**: Error messages include relevant context (expected annotation format, available story files)
- **REQ-ERROR-CONSISTENCY**: All plugin rules use consistent error message format and terminology
- **REQ-ERROR-SEVERITY**: Error severity levels are appropriate (error for missing annotations, warning for format issues)

## Error Message Conventions

Cross-rule error messages follow these shared patterns for consistency and clarity:

- **Function-related errors**
  - Use `{{functionName}}` to identify the affected function or method.
  - Typical pattern:
    - `"Function '{{functionName}}' is missing a required @story annotation."`
    - `"Function '{{functionName}}' has an invalid @req annotation: {{details}}."`

- **Branch-related errors**
  - Use a generic `missingAnnotation`-style message with a `{{missing}}` placeholder to describe what is absent.
  - Typical pattern:
    - `"Branch is missing required annotation: {{missing}}."`

- **Format / validation details**
  - Use a `{{details}}` placeholder for human-readable validation output, such as expected formats or concrete problems.
  - Typical pattern:
    - `"Invalid annotation format: {{details}}."`

- **File / reference errors**
  - Use `{{filePath}}` (and when applicable, `{{storyId}}` / `{{reqId}}`) to indicate problematic references.
  - Typical pattern:
    - `"Referenced story file '{{filePath}}' could not be found."`
    - `"Requirement '{{reqId}}' was not found in '{{filePath}}'."`

- **Severity conventions**
  - **Errors** (`severity: 2`):
    - Missing required annotations (e.g., missing `@story` or `@req`).
    - Missing or unresolved referenced files or requirement IDs.
  - **Warnings** (`severity: 1`):
    - Annotation format or style issues that do not break traceability, e.g., spacing, optional fields, or non-critical structure problems.

All rules expose these messages through `meta.messages` with `messageId` values that are reused where appropriate, ensuring consistent wording and behavior across function, branch, and file validation rules.

## Dependencies

- 003.0-DEV-FUNCTION-ANNOTATIONS (error reporting needs function annotation validation logic)
- 004.0-DEV-BRANCH-ANNOTATIONS (error reporting needs branch annotation validation logic)
- 005.0-DEV-ANNOTATION-VALIDATION (error reporting needs annotation format validation results)
- 006.0-DEV-FILE-VALIDATION (error reporting needs file validation results)

**Dependency Rules**:

- Story numbers MUST be greater than all dependency story numbers
- Dependencies should be from in-scope stories when possible
- Cross-release dependencies should be clearly justified
- No circular dependencies allowed

## Implementation Notes (Optional)

**Development Resources**:

- See [Custom ESLint Rules Development Guide](../custom-rules-development-guide.md) for error reporting patterns
- Review [Reporting Problems](../custom-rules-development-guide.md#reporting-problems) for context.report() usage
- See [Providing Suggestions](../custom-rules-development-guide.md#providing-suggestions) for suggestion API

**Current Rule Implementations**

- `traceability/require-story-annotation`
  - Uses `meta.messages.missingStory` with pattern `Function '{{name}}' is missing a required @story annotation. ...` and provides ESLint suggestions via `suggest` in `context.report()`.
- `traceability/require-req-annotation`
  - Uses `meta.messages.missingReq` with pattern `Function '{{name}}' is missing a required @req annotation. Add a JSDoc or line comment with @req (for example, '@req REQ-EXAMPLE') ...` and reports the function name via both `name` and `functionName` data fields.
- `traceability/require-branch-annotation`
  - Uses `meta.messages.missingAnnotation` with pattern `Branch is missing required annotation: {{missing}}.` for branch-level errors.
- `traceability/valid-annotation-format`
  - Uses `meta.messages.invalidStoryFormat` and `meta.messages.invalidReqFormat` with pattern `Invalid annotation format: {{details}}.` where `details` contains the more specific validation message (missing path, invalid ID, etc.).
- `traceability/valid-story-reference`
  - Uses `meta.messages.fileMissing`, `invalidExtension`, `invalidPath`, and `fileAccessError` to distinguish missing files from filesystem errors and invalid paths.
- `traceability/valid-req-reference`
  - Uses `meta.messages.reqMissing` and `invalidPath` to report missing requirement IDs and unsafe story paths, including both `reqId` and `storyPath` in the message data.

**Technical Considerations**:

- Use ESLint's context.report() method for consistent error reporting
- Implement error message templates in meta.messages using messageIds (recommended approach)
- Use data placeholders for dynamic error information (e.g., `{{functionName}}`, `{{filePath}}`)
- Consider internationalization support for error messages
- Include suggestions using ESLint's suggest API where appropriate for manual fixes

**Key Guide Sections**:

- [Reporting Problems](../custom-rules-development-guide.md#reporting-problems) - Complete guide to context.report() and messageIds
- [Providing Suggestions](../custom-rules-development-guide.md#providing-suggestions) - Using hasSuggestions and suggest array

**Integration Points**:

- Enhance existing validation rules from stories 003.0-006.0
- Integrate with ESLint's built-in error reporting and formatting
- Ensure compatibility with different ESLint output formats (stylish, json, etc.)

**Testing Strategy**:

- Unit tests for each error message scenario
- Integration tests with various code patterns
- Manual testing with developers for message clarity
- Verify error messages work in different IDEs and editors

## Definition of Done

- [x] All acceptance criteria met
- [x] Code reviewed and approved
- [x] Tests written and passing
- [x] Documentation updated
- [x] Deployed to appropriate environment
- [x] Stakeholder acceptance confirmed
