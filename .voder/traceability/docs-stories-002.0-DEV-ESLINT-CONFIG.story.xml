<?xml version="1.0" encoding="UTF-8"?>
<traceability>
  <specification>docs/stories/002.0-DEV-ESLINT-CONFIG.story.md</specification>
  <status>PASSED</status>
  <last_validated>2025-11-21T01:24:48.620Z</last_validated>
  <last_modified>2025-11-16T00:07:54.396Z</last_modified>
  <evidence>1) Core presets (REQ-CONFIG-PRESETS / Core Functionality):
- src/index.ts exports a `configs` object with `recommended` and `strict` presets, each an array of flat-config objects enabling all traceability rules at 'error'.
- tests/plugin-default-export-and-configs.test.ts asserts: (a) default export contains `rules` and `configs`; (b) `rules` has all expected rule names; (c) `configs.recommended[0].rules` contains the expected traceability rules; (d) `configs.strict[0].rules` equals `configs.recommended[0].rules`.

2) ESLint v9 flat config & quality standards (REQ-FLAT-CONFIG / Quality Standards):
- The plugin presets are designed for ESLint v9 flat config, returned as arrays of config objects (src/index.ts) and consumed via `traceability.configs.recommended` in flat configs.
- eslint.config.js at project root is itself a flat config: it exports an array of config objects (using @eslint/js’s `js.configs.recommended`, TS/JS/test overrides, and ignore block).
- eslint.config.js is explicitly annotated with `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md` and `@req REQ-FLAT-CONFIG`.
- docs/eslint-9-setup-guide.md and user-docs/eslint-9-setup-guide.md provide step-by-step ESLint 9 flat config guidance, including usage of `traceability.configs.recommended` with `js.configs.recommended`.

3) Integration with existing ESLint configs (REQ-PROJECT-INTEGRATION / Integration):
- README.md shows usage in a typical ESLint v9 setup: importing `eslint-plugin-traceability` and using `traceability.configs.recommended` in eslint.config.js alongside `@eslint/js` presets.
- docs/config-presets.md demonstrates combining `js.configs.recommended` with `traceability.configs.recommended` or `traceability.configs.strict`.
- user-docs/eslint-9-setup-guide.md contains concrete examples for JavaScript-only, TypeScript, mixed JS/TS, monorepos, Node config files, and test files, all using flat config arrays that can incorporate the plugin presets.
- tests/integration/cli-integration.test.ts runs the ESLint CLI using the project’s eslint.config.js (`--no-config-lookup --config eslint.config.js`) and verifies that rules like `traceability/require-story-annotation` and `traceability/require-req-annotation` execute as expected. This confirms the plugin integrates and works via ESLint’s normal configuration mechanism.

4) Customizable paths & rule options (REQ-CUSTOMIZABLE-PATHS, REQ-RULE-OPTIONS):
- src/rules/valid-story-reference.ts defines `meta.schema` with an options object containing properties: `storyDirectories` (array of strings), `allowAbsolutePaths` (boolean), and `requireStoryExtension` (boolean), and sets `additionalProperties: false`.
- valid-story-reference’s `create` function reads `context.options[0]` and applies these options to control story directory resolution, whether absolute paths are allowed, and whether the `.story.md` extension is required.
- src/rules/require-story-annotation.ts defines `meta.schema` with configurable options `scope` (array of strings limited to DEFAULT_SCOPE values) and `exportPriority` (string, enum EXPORT_PRIORITY_VALUES), and sets `additionalProperties: false`. The rule’s `create` function reads `context.options[0]` to apply these options, satisfying configurable per-rule behavior.

5) Configuration validation and error handling for options (REQ-CONFIG-VALIDATION / Error Handling):
- tests/config/eslint-config-validation.test.ts (header `/** @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md */`) verifies:
  - `[REQ-RULE-OPTIONS]` that `valid-story-reference.meta.schema[0].properties` includes `storyDirectories`, `allowAbsolutePaths`, `requireStoryExtension`.
  - `[REQ-CONFIG-VALIDATION]` that `schema.additionalProperties` is `false`, ensuring unknown configuration options are rejected by ESLint’s schema validation.
- tests/config/require-story-annotation-config.test.ts (also tagged with this story) verifies `[REQ-RULE-OPTIONS]` for `require-story-annotation`: `schema[0].properties` includes `scope` and `exportPriority`, and `additionalProperties` is `false`.
- Combined, these schemas and tests ensure invalid configuration options are caught and reported by ESLint’s config validation (graceful handling rather than crashes or silent ignoring), directly implementing REQ-CONFIG-VALIDATION and the Error Handling acceptance criterion for invalid options.

6) User experience & documentation (User Experience / Documentation):
- README.md provides:
  - Installation instructions and prerequisites (Node >=14, ESLint v9+).
  - A basic flat-config example showing how to enable the traceability rules via `traceability.configs.recommended` and how to enable individual rules.
  - Links to user-docs, including ESLint 9 Setup Guide, API reference, examples, migration guide, and a dedicated Configuration Presets doc.
- docs/config-presets.md clearly documents the `recommended` and `strict` presets, listing which traceability rules are enabled and showing example flat-config usage, directly addressing configuration clarity.
- user-docs/eslint-9-setup-guide.md (user-facing) provides:
  - Quick setup steps for ESLint 9 (dependency installation, eslint.config.js creation, package scripts) and explicit instructions for enabling the traceability plugin (`import traceability from "eslint-plugin-traceability"; export default [js.configs.recommended, traceability.configs.recommended];`).
  - Sections on common configuration patterns (JS-only, TS, mixed, monorepos, Node config, tests) and how to structure flat configs accordingly.
  - A dedicated `Troubleshooting ESLint Configuration` section giving concrete guidance on common misconfigurations (parser usage, deprecated flags, missing globals, incorrect extends usage), fulfilling the requirement for a troubleshooting guide.

7) Project’s own ESLint configuration behavior (Quality Standards / Integration / Error Handling):
- eslint.config.js is itself part of this story (annotated with `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md`), and:
  - Uses flat config array structure with multiple overrides and an ignores block, following ESLint v9 best practices.
  - Dynamically loads the plugin from `./src/index.js` or `./lib/src/index.js`; in CI it throws a clear error if neither exists (ensuring CI fails fast when plugin is not built); locally it logs a warning and continues with an empty plugin object to avoid blocking development. This reflects robust handling around plugin availability in configuration.

8) Tests explicitly tied to this story:
- tests/config/eslint-config-validation.test.ts:
  - Header comment: `/** @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md */`.
  - Describe block: "ESLint Configuration Setup (Story 002.0-DEV-ESLINT-CONFIG)".
  - Contains tests for `[REQ-RULE-OPTIONS]` and `[REQ-CONFIG-VALIDATION]`.
- tests/config/require-story-annotation-config.test.ts:
  - Header comment: `/** @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md */`.
  - Describe block: "ESLint Configuration Rule Options (Story 002.0-DEV-ESLINT-CONFIG)".
  - Contains tests for `[REQ-RULE-OPTIONS]` around the require-story-annotation rule’s schema.
- These provide direct, traceable test coverage against the specific requirements listed in the story.

9) Test execution evidence:
- The assessment environment ran `npm test -- --runInBand --verbose`, which invoked `jest --ci --bail --runInBand --verbose`.
- The output shows debug logging from the rules but no errors or failed tests, indicating that all Jest tests—including the configuration tests bound to this story—passed successfully.

Given this evidence, all acceptance criteria are met: presets exist and are tested; configuration follows ESLint v9 flat config patterns and is documented; integration with other configs and common project types is demonstrated in docs and integration tests; rule and path options are configurable and validated via JSON Schema; invalid config options are handled gracefully through schema-based validation; and comprehensive configuration examples and troubleshooting documentation are present.</evidence>
  <notes>The ESLint configuration layer described in docs/stories/002.0-DEV-ESLINT-CONFIG.story.md is fully implemented. The plugin exposes recommended and strict presets designed for ESLint v9 flat config, the project and documentation demonstrate correct flat-config usage across JS/TS/mixed/monorepo scenarios, configuration options for both path handling and rule behavior are implemented with JSON Schema and validated by tests, and user-facing docs (README, setup guides, config-presets, troubleshooting) provide clear guidance for integrating the plugin into existing ESLint setups. All related tests pass, and there is explicit traceability from tests and configuration files back to this story, so the story is considered complete.</notes>
</traceability>