<?xml version="1.0" encoding="UTF-8"?>
<traceability>
  <specification>docs/stories/002.0-DEV-ESLINT-CONFIG.story.md</specification>
  <status>PASSED</status>
  <last_validated>2025-11-21T08:36:31.013Z</last_validated>
  <last_modified>2025-11-16T00:07:54.396Z</last_modified>
  <evidence>Implementation and tests clearly cover all requirements in docs/stories/002.0-DEV-ESLINT-CONFIG.story.md:

1) Core Functionality – Recommended & Strict Presets (REQ-CONFIG-PRESETS)
- src/index.ts defines config presets:
  const configs = {
    recommended: [
      {
        plugins: { traceability: {} },
        rules: {
          "traceability/require-story-annotation": "error",
          "traceability/require-req-annotation": "error",
          "traceability/require-branch-annotation": "error",
          "traceability/valid-annotation-format": "warn",
          "traceability/valid-story-reference": "error",
          "traceability/valid-req-reference": "error"
        }
      }
    ],
    strict: [
      {
        plugins: { traceability: {} },
        rules: {
          "traceability/require-story-annotation": "error",
          "traceability/require-req-annotation": "error",
          "traceability/require-branch-annotation": "error",
          "traceability/valid-annotation-format": "warn",
          "traceability/valid-story-reference": "error",
          "traceability/valid-req-reference": "error"
        }
      }
    ]
  };
  export { rules, configs };
  export default { rules, configs };
- tests/plugin-default-export-and-configs.test.ts verifies:
  - default export includes rules and configs
  - configs.recommended contains the expected rules
  - configs.strict contains the same rules as recommended

2) ESLint v9 Flat Config Best Practices (REQ-FLAT-CONFIG)
- eslint.config.js is a flat config array and is explicitly annotated for this story:
  /**
   * ESLint flat config for Traceability Plugin
   * @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md
   * @req REQ-FLAT-CONFIG - Setup ESLint v9 flat config for plugin usage
   */
  const typescriptParser = require("@typescript-eslint/parser");
  const js = require("@eslint/js");
  module.exports = [
    js.configs.recommended,
    { files: ["*.config.js", "*.config.mjs", "jest.config.js"], ... },
    { files: ["**/*.ts", "**/*.tsx"], languageOptions: { parser: typescriptParser, ... }, plugins: { ...(plugin.rules ? { traceability: plugin } : {}) }, rules: { ... } },
    { files: ["**/*.js", "**/*.jsx"], plugins: { ...(plugin.rules ? { traceability: plugin } : {}) }, rules: { ... } },
    { files: ["**/*.test.{js,ts,tsx}", "**/__tests__/**/*.{js,ts,tsx}", "**/tests/**/*.{js,ts,tsx}"], ... },
    { ignores: ["lib/**", "node_modules/**", "coverage/**", "docs/**", "*.md", ...] }
  ];
- README.md provides an explicit "Example eslint.config.js (ESLint v9 flat config)" snippet and a Quick Start section using traceability.configs.recommended.
- user-docs/eslint-9-setup-guide.md is a comprehensive guide on ESLint 9 flat config and shows integrating traceability via:
  import js from "@eslint/js";
  import traceability from "eslint-plugin-traceability";
  export default [js.configs.recommended, traceability.configs.recommended];

3) Customizable Paths & Rule Options (REQ-CUSTOMIZABLE-PATHS, REQ-RULE-OPTIONS)
- src/rules/valid-story-reference.ts implements configurable story paths and options:
  meta: {
    schema: [
      {
        type: "object",
        properties: {
          storyDirectories: { type: "array", items: { type: "string" } },
          allowAbsolutePaths: { type: "boolean" },
          requireStoryExtension: { type: "boolean" }
        },
        additionalProperties: false
      }
    ]
  },
  create(context) {
    const opts = context.options[0] as {
      storyDirectories?: string[];
      allowAbsolutePaths?: boolean;
      requireStoryExtension?: boolean;
    } | undefined;
    const storyDirs = opts?.storyDirectories || ["docs/stories", "stories"];
    const allowAbsolute = opts?.allowAbsolutePaths || false;
    const requireExt = opts?.requireStoryExtension !== false;
    ...
  }
- src/rules/require-story-annotation.ts defines configurable rule options:
  meta: {
    schema: [
      {
        type: "object",
        properties: {
          scope: {
            type: "array",
            items: { type: "string", enum: DEFAULT_SCOPE },
            uniqueItems: true
          },
          exportPriority: { type: "string", enum: EXPORT_PRIORITY_VALUES }
        },
        additionalProperties: false
      }
    ]
  }
- Tests explicitly linked to this story validate these options and schemas:
  - tests/config/eslint-config-validation.test.ts:
    /** @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md */
    describe("ESLint Configuration Setup (Story 002.0-DEV-ESLINT-CONFIG)", () => {
      it("[REQ-RULE-OPTIONS] rule meta.schema defines expected properties", () => {
        const schema = ((validStoryReference.meta as any).schema as any)[0];
        expect(schema.properties).toHaveProperty("storyDirectories");
        expect(schema.properties).toHaveProperty("allowAbsolutePaths");
        expect(schema.properties).toHaveProperty("requireStoryExtension");
      });
      it("[REQ-CONFIG-VALIDATION] schema disallows unknown options", () => {
        const schema = ((validStoryReference.meta as any).schema as any)[0];
        expect(schema.additionalProperties).toBe(false);
      });
    });
  - tests/config/require-story-annotation-config.test.ts:
    /** @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md */
    describe("ESLint Configuration Rule Options (Story 002.0-DEV-ESLINT-CONFIG)", () => {
      it("[REQ-RULE-OPTIONS] require-story-annotation schema defines expected properties", () => {
        const schema = ((requireStoryAnnotation.meta as any).schema as any)[0];
        expect(schema.properties).toHaveProperty("scope");
        expect(schema.properties).toHaveProperty("exportPriority");
        expect(schema.additionalProperties).toBe(false);
      });
    });
- tests/config/valid-config.json illustrates a valid configuration object using those options.

4) Integration with ESLint & Existing Configurations (REQ-PROJECT-INTEGRATION, Integration AC)
- Integration test runs ESLint CLI with the project’s flat config and plugin:
  - tests/integration/cli-integration.test.ts:
    const eslintCliPath = path.join(eslintPkgDir, "bin", "eslint.js");
    const configPath = path.resolve(__dirname, "../../eslint.config.js");
    const args = [
      "--no-config-lookup",
      "--config",
      configPath,
      "--stdin",
      "--stdin-filename",
      "foo.js",
      "--rule",
      "no-unused-vars:off",
      "--rule",
      rule
    ];
    const result = spawnSync(process.execPath, [eslintCliPath, ...args], { encoding: "utf-8", input: code });
    expect(result.status).toBe(expectedStatus);
- This demonstrates the plugin’s configs integrate cleanly with standard ESLint configurations and CLI usage.

5) Error Handling & Configuration Validation (REQ-CONFIG-VALIDATION, Error Handling AC)
- Schema definitions for rules include additionalProperties: false, ensuring unknown options cause ESLint configuration errors with clear messages. This is explicitly asserted in tests for valid-story-reference and require-story-annotation.
- require-branch-annotation also validates its options via a helper (validateBranchTypes), returning a listener that reports configuration problems when branchTypes is invalid; schema likewise has additionalProperties: false.

6) Documentation & User Experience (User Experience AC, Documentation AC)
- docs/config-presets.md documents recommended and strict presets, including flat-config examples and explicit lists of enabled rules and severities.
- user-docs/api-reference.md includes a "Configuration Presets" section that documents `traceability.configs.recommended` and `traceability.configs.strict` and gives usage examples. It also documents per-rule options (including valid-story-reference’s storyDirectories / allowAbsolutePaths / requireStoryExtension and the require-story-annotation options), satisfying configuration documentation.
- user-docs/eslint-9-setup-guide.md provides step-by-step ESLint 9 flat-config setup, with a dedicated section on enabling the traceability plugin and extensive troubleshooting guidance for flat config issues.
- user-docs/examples.md shows concrete flat-config examples for both recommended and strict presets.
- README.md highlights ESLint v9, links to the ESLint 9 setup guide, and provides example flat configs and a Quick Start that uses traceability.configs.recommended.

7) Tests Linked to This Story & Overall Test Status
- Tests explicitly annotated with this story:
  - tests/config/eslint-config-validation.test.ts
  - tests/config/require-story-annotation-config.test.ts
  - eslint.config.js header references docs/stories/002.0-DEV-ESLINT-CONFIG.story.md.
- The full Jest suite (including these tests) was run with verbose output:
  - Command: npm test -- --runInBand --verbose --testLocationInResults
  - Jest completed without test failures (output shows only expected console.debug logs from require-story-annotation). This confirms configuration-related behavior passes automated tests.</evidence>
  <notes>All acceptance criteria and requirements for 002.0-DEV-ESLINT-CONFIG are satisfied. The plugin exposes recommended and strict presets via flat-config-friendly exports, the repository itself and documentation demonstrate ESLint v9 flat config best practices, rule options are configurable and validated via JSON Schemas (with tests explicitly asserting schema properties and additionalProperties=false), and configuration integration is verified via CLI integration tests. Comprehensive user-facing documentation (setup guide, presets doc, API reference, examples, migration guide, README) provides clear setup instructions, examples, and troubleshooting for common project types (JS, TS, mixed, monorepos). The tests tagged with this story pass in the overall Jest test run, providing concrete verification that the configuration system behaves as specified. Therefore this story is fully implemented and passes.</notes>
</traceability>