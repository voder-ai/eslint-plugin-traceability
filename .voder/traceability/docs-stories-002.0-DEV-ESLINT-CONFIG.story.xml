<?xml version="1.0" encoding="UTF-8"?>
<traceability>
  <specification>docs/stories/002.0-DEV-ESLINT-CONFIG.story.md</specification>
  <status>PASSED</status>
  <last_validated>2025-11-21T07:35:56.092Z</last_validated>
  <last_modified>2025-11-16T00:07:54.396Z</last_modified>
  <evidence>Key implementation and tests found for docs/stories/002.0-DEV-ESLINT-CONFIG.story.md:

1) Core configuration presets (REQ-CONFIG-PRESETS):
- src/index.ts defines:
  - const configs = {
      recommended: [ { plugins: { traceability: {} }, rules: { ... } } ],
      strict:      [ { plugins: { traceability: {} }, rules: { ... } } ],
    };
- Both presets enable the core traceability rules:
  - traceability/require-story-annotation
  - traceability/require-req-annotation
  - traceability/require-branch-annotation
  - traceability/valid-annotation-format
  - traceability/valid-story-reference
  - traceability/valid-req-reference
- tests/plugin-default-export-and-configs.test.ts verifies:
  - default export includes rules and configs
  - rules object has the expected rule names
  - configs.recommended[0].rules contains the correct rules
  - configs.strict[0].rules equals configs.recommended[0].rules

2) ESLint v9 flat config best practices (REQ-FLAT-CONFIG, Integration):
- Root eslint.config.js is a flat-config array and is explicitly annotated with this story:
  /**
   * ESLint flat config for Traceability Plugin
   * @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md
   * @req REQ-FLAT-CONFIG - Setup ESLint v9 flat config for plugin usage
   */
- Uses @eslint/js flat presets and per-file overrides:
  - js.configs.recommended
  - Separate blocks for:
    - Node config files (CommonJS)
    - TypeScript files (parser: @typescript-eslint/parser, project/tsconfigRootDir)
    - JavaScript files
    - Test files (Jest globals, relaxed complexity rules)
    - Ignores (lib/**, node_modules/**, coverage/**, docs/**, *.md, etc.)
- Plugin loading is robust:
  - Tries ./src/index.js, then ./lib/src/index.js
  - In CI, throws a clear error if plugin is missing; in local dev, warns and continues with an empty plugin.

3) Customizable paths and rule options (REQ-CUSTOMIZABLE-PATHS, REQ-RULE-OPTIONS):
- src/rules/valid-story-reference.ts:
  - meta.schema[0]:
    { type: "object", properties: {
        storyDirectories: { type: "array", items: { type: "string" } },
        allowAbsolutePaths: { type: "boolean" },
        requireStoryExtension: { type: "boolean" }
      }, additionalProperties: false }
  - create(context) reads:
    - storyDirectories, allowAbsolutePaths, requireStoryExtension
    - Applies them via storyDirs, allowAbsolute, requireExt in validation logic.
- src/rules/require-story-annotation.ts:
  - meta.schema[0] with properties:
    - scope: array of strings from DEFAULT_SCOPE
    - exportPriority: string from EXPORT_PRIORITY_VALUES
    - additionalProperties: false
  - create(context) reads opts.scope and opts.exportPriority and uses them to drive behavior.
- Tests tied directly to this story:
  - tests/config/eslint-config-validation.test.ts (header: /** @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md */):
    - it("[REQ-RULE-OPTIONS] rule meta.schema defines expected properties", ...) asserts valid-story-reference schema has storyDirectories, allowAbsolutePaths, requireStoryExtension.
    - it("[REQ-CONFIG-VALIDATION] schema disallows unknown options", ...) asserts schema.additionalProperties is false.
  - tests/config/require-story-annotation-config.test.ts (same story):
    - it("[REQ-RULE-OPTIONS] require-story-annotation schema defines expected properties", ...) asserts schema has scope, exportPriority and additionalProperties is false.
- Example configuration using these options:
  - tests/config/valid-config.json configures valid-story-reference with customized storyDirectories, allowAbsolutePaths, requireStoryExtension.

4) Configuration validation and error handling (REQ-CONFIG-VALIDATION, Error Handling):
- Both key rules expose JSON Schema with additionalProperties: false:
  - valid-story-reference (see above)
  - require-story-annotation (see above)
- This causes ESLint to reject unknown/invalid configuration options with clear schema-based errors.
- Tests in tests/config/eslint-config-validation.test.ts and tests/config/require-story-annotation-config.test.ts explicitly assert additionalProperties: false for these schemas.

5) Project integration for TS/JS/mixed projects (REQ-PROJECT-INTEGRATION, Integration criterion):
- Current eslint.config.js shows real integration in a mixed TS/JS plugin project:
  - TS override for **/*.ts, **/*.tsx with @typescript-eslint/parser and tsconfig-based parserOptions.
  - JS override for **/*.js, **/*.jsx.
  - Special handling for Node config files and Jest test files.
- user-docs/eslint-9-setup-guide.md gives multiple configuration patterns:
  - JavaScript-only project
  - TypeScript project
  - Mixed JS/TS project
  - Monorepos/workspaces
  - Node.js config files
  - Test files (Jest/Vitest)
- This combination demonstrates how to integrate the plugin across typical real-world project structures.

6) User documentation and troubleshooting (User Experience & Documentation criteria):
- README.md:
  - States ESLint v9 requirement.
  - Shows example flat ESLint config using the plugin.
  - Provides a Quick Start using traceability.configs.recommended.
  - Links to user-docs/eslint-9-setup-guide.md and user-docs/api-reference.md for detailed configuration and per-rule options.
- user-docs/eslint-9-setup-guide.md:
  - Labeled as an ESLint 9 Setup Guide (user-facing).
  - Includes many complete example eslint.config.js configurations for diverse setups.
  - Has sections "Common Issues and Solutions" and "Troubleshooting ESLint Configuration" with concrete misconfigurations and fixes.
  - Provides a full "Working Example" flat config for a TypeScript ESLint plugin project and matching package.json scripts.

7) Tests for this story and overall config behavior are passing:
- Story-specific tests:
  - tests/config/eslint-config-validation.test.ts
  - tests/config/require-story-annotation-config.test.ts
- Supporting config/plugin tests:
  - tests/plugin-default-export-and-configs.test.ts
  - tests/plugin-setup.test.ts
- Test run (executed in this environment):
  - Command: npm test -- --ci --bail --runInBand --verbose
  - Jest executed without reporting any failing tests. Output consisted of console.debug logs from rules but no failure summaries or error stacks, indicating these tests pass.</evidence>
  <notes>All acceptance criteria for 002.0-DEV-ESLINT-CONFIG are satisfied:
- Core Functionality: The plugin exposes recommended and strict presets via configs in src/index.ts, verified by tests.
- Quality Standards: The project uses ESLint v9 flat configuration (eslint.config.js) in a best-practice structure, annotated with this story, and user-docs further document correct flat-config usage.
- Integration: eslint.config.js and the ESLint 9 setup guide show clear, working integration patterns for JavaScript, TypeScript, mixed projects, config files, and tests.
- User Experience: README and user-docs/eslint-9-setup-guide.md provide clear setup instructions, examples, and guidance for common project types.
- Error Handling: Rule options are defined and validated via JSON Schema (additionalProperties: false), so invalid configuration keys are caught with clear errors; tests assert these schemas.
- Documentation: There are comprehensive configuration examples and a dedicated troubleshooting guide in user-docs/eslint-9-setup-guide.md, plus rule docs and API references.
Given the concrete implementation, tests explicitly tied to this story, and successful test execution, this story is assessed as fully implemented and passing.</notes>
</traceability>