<?xml version="1.0" encoding="UTF-8"?>
<traceability>
  <specification>docs/stories/002.0-DEV-ESLINT-CONFIG.story.md</specification>
  <status>PASSED</status>
  <last_validated>2025-11-21T00:25:08.420Z</last_validated>
  <last_modified>2025-11-16T00:07:54.396Z</last_modified>
  <evidence>1) Core functionality (REQ-CONFIG-PRESETS): src/index.ts defines both `recommended` and `strict` configuration presets as flat-config-compatible arrays of config objects:

```ts
const configs = {
  recommended: [ { plugins: { traceability: {} }, rules: { ... } } ],
  strict: [ { plugins: { traceability: {} }, rules: { ... } } ],
};
export { rules, configs };
export default { rules, configs };
```

Tests in tests/plugin-default-export-and-configs.test.ts verify:
- The default export includes `rules` and `configs`.
- `configs.recommended[0].rules` contains the expected traceability rules.
- `configs.strict[0].rules` is equal to `configs.recommended[0].rules`.

2) ESLint v9 flat config best practices (REQ-FLAT-CONFIG / Quality Standards):
- eslint.config.js is a flat-config file exporting an array of configuration objects using @eslint/js and per-file overrides:
```js
/**
 * ESLint flat config for Traceability Plugin
 * @story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md
 * @req REQ-FLAT-CONFIG - Setup ESLint v9 flat config for plugin usage
 */
const typescriptParser = require("@typescript-eslint/parser");
const js = require("@eslint/js");
...
module.exports = [
  js.configs.recommended,
  { files: ["*.config.js", ...], languageOptions: {...} },
  { files: ["**/*.ts", "**/*.tsx"], languageOptions: {...}, plugins: {...}, rules: {...} },
  { files: ["**/*.js", "**/*.jsx"], ... },
  { files: ["**/*.test.{js,ts,tsx}", ...], ... },
  { ignores: ["lib/**", "node_modules/**", ...] },
];
```
- README.md, docs/config-presets.md, user-docs/eslint-9-setup-guide.md, and user-docs/examples.md all show ESLint v9 flat config usage patterns, including:
```js
import js from "@eslint/js";
import traceability from "eslint-plugin-traceability";
export default [js.configs.recommended, traceability.configs.recommended];
```
This aligns the plugin’s presets and usage with ESLint v9 flat config best practices.

3) Integration with existing ESLint configs and project types (REQ-PROJECT-INTEGRATION / Integration):
- eslint.config.js demonstrates integration with:
  - @eslint/js base config.
  - TypeScript via @typescript-eslint/parser with project-aware parserOptions.
  - Separate overrides for Node config files, TypeScript files, JavaScript files, and tests.
  - Conditional plugin loading from ./src/index.js or ./lib/src/index.js with CI-specific error handling.
- user-docs/eslint-9-setup-guide.md contains full configuration examples for:
  - JavaScript-only projects.
  - TypeScript projects.
  - Mixed JS/TS projects.
  - Monorepos/workspaces.
- user-docs/examples.md shows concrete examples of using `traceability.configs.recommended` and `.strict` in real flat-config setups.
- tests/integration/cli-integration.test.ts runs ESLint via its real CLI with this repository’s eslint.config.js and plugin rules enabled, verifying that the plugin and its configuration work end-to-end and do not conflict with ESLint’s CLI behavior.

4) Configurability, rule options, and validation (REQ-CUSTOMIZABLE-PATHS, REQ-RULE-OPTIONS, REQ-CONFIG-VALIDATION / Error Handling):
- src/rules/valid-story-reference.ts exposes configurable options through its meta.schema:
```ts
schema: [
  {
    type: "object",
    properties: {
      storyDirectories: { type: "array", items: { type: "string" } },
      allowAbsolutePaths: { type: "boolean" },
      requireStoryExtension: { type: "boolean" },
    },
    additionalProperties: false,
  },
],
```
  and reads them in create():
```ts
const opts = context.options[0] as { storyDirectories?: string[]; allowAbsolutePaths?: boolean; requireStoryExtension?: boolean } | undefined;
const storyDirs = opts?.storyDirectories || defaultStoryDirs; // defaultStoryDirs = ["docs/stories", "stories"]
const allowAbsolute = opts?.allowAbsolutePaths || false;
const requireExt = opts?.requireStoryExtension !== false;
```
  This satisfies customizable paths and rule options.
- src/rules/require-story-annotation.ts defines a schema enforcing valid options:
```ts
schema: [
  {
    type: "object",
    properties: {
      scope: { type: "array", items: { type: "string", enum: DEFAULT_SCOPE }, uniqueItems: true },
      exportPriority: { type: "string", enum: EXPORT_PRIORITY_VALUES },
    },
    additionalProperties: false,
  },
],
```
- Tests tied directly to this story validate these schemas:
  - tests/config/eslint-config-validation.test.ts (header `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md`):
    - `[REQ-RULE-OPTIONS] rule meta.schema defines expected properties` (checks `storyDirectories`, `allowAbsolutePaths`, `requireStoryExtension`).
    - `[REQ-CONFIG-VALIDATION] schema disallows unknown options` (expects `additionalProperties` to be false).
  - tests/config/require-story-annotation-config.test.ts (also `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md`):
    - Ensures the `require-story-annotation` schema exposes `scope` and `exportPriority` and disallows additional properties.
  These schemas ensure ESLint itself performs config validation and produces clear error messages on invalid/unknown options, providing “graceful handling of invalid configuration options” per the story.

5) Documentation and user experience (User Experience, Documentation acceptance criteria):
- README.md:
  - States prerequisites (Node >= 14, ESLint v9+).
  - Shows a minimal flat-config ESLint example with the plugin.
  - Links to user-docs/eslint-9-setup-guide.md, user-docs/api-reference.md, user-docs/examples.md, and docs/config-presets.md.
- docs/config-presets.md:
  - Contains dedicated sections describing the recommended and strict presets and how to include them in eslint.config.js.
- user-docs/eslint-9-setup-guide.md:
  - Provides a detailed ESLint 9 flat-config guide, including quick setup, patterns for JS, TS, mixed projects, monorepos, and a full working example that integrates the plugin.
  - Includes a “Troubleshooting ESLint Configuration” section, satisfying the requested troubleshooting guidance.
- user-docs/examples.md:
  - Provides concrete, runnable configuration examples using recommended and strict presets.
- user-docs/migration-guide.md:
  - Documents how to migrate from older versions to v1.x using flat config and the plugin’s recommended preset.
Together, these documents address setup, common project types (TS/JS/mixed), examples, and troubleshooting, fulfilling the story’s documentation and user-experience criteria.

6) Tests and passing status (Definition of Done – tests for configuration, validation, rule application):
- Story-specific tests:
  - tests/config/eslint-config-validation.test.ts includes `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md` and tests `[REQ-RULE-OPTIONS]` and `[REQ-CONFIG-VALIDATION]`.
  - tests/config/require-story-annotation-config.test.ts includes `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md` and tests `[REQ-RULE-OPTIONS]` for the require-story-annotation rule.
- valid-story-reference rule tests in tests/rules/valid-story-reference.test.ts include a valid case referencing `docs/stories/002.0-DEV-ESLINT-CONFIG.story.md`, confirming that a real story file for this spec is correctly recognized by the rule.
- Integration/CLI tests:
  - tests/integration/cli-integration.test.ts runs ESLint CLI with this repository’s eslint.config.js and different traceability rules, verifying end-to-end configuration behavior.
- Running `npm test -- --ci --no-watch --runInBand --verbose` (via the project’s configured test script) completes successfully with debug output from the rules but no reported Jest failures, indicating all configuration-related tests pass.

7) Traceability:
- eslint.config.js is explicitly annotated with this story:
  - `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md` and `@req REQ-FLAT-CONFIG`.
- Two dedicated config-focused test files carry `@story docs/stories/002.0-DEV-ESLINT-CONFIG.story.md`, and their test names reference `[REQ-RULE-OPTIONS]` and `[REQ-CONFIG-VALIDATION]`.
- The valid-story-reference rule test suite includes a valid `@story` for `002.0-DEV-ESLINT-CONFIG.story.md`, ensuring the story’s own file is part of the validation matrix.

Collectively, this provides concrete evidence that configuration presets, ESLint v9 flat-config integration, customizable rule options, config validation, documentation, and tests tied to this story are fully implemented and passing.</evidence>
  <notes>All acceptance criteria in docs/stories/002.0-DEV-ESLINT-CONFIG.story.md are satisfied. The plugin exposes recommended and strict presets, demonstrated and tested as flat-config-friendly configs. ESLint v9 flat config best practices are followed in eslint.config.js and in multiple user guides. Configuration is easily integrated into JS, TS, and mixed projects with clear examples and a working reference. Rule options for configuration (scope, exportPriority, storyDirectories, allowAbsolutePaths, requireStoryExtension) are defined via JSON-Schema-style meta.schema and validated by ESLint, with tests explicitly tied to this story confirming schema correctness and rejection of unknown options. Documentation (README, config-presets, ESLint 9 setup guide, examples, migration guide) provides setup instructions, examples, and troubleshooting for common project types. Jest tests, including the configuration-focused tests for this story, run and pass using the project’s npm test script. Therefore, the story’s definition of done is met and the implementation is considered PASSED.</notes>
</traceability>