<?xml version="1.0" encoding="UTF-8"?>
<traceability>
  <specification>docs/stories/008.0-DEV-AUTO-FIX.story.md</specification>
  <status>FAILED</status>
  <last_validated>2025-11-21T01:25:58.766Z</last_validated>
  <last_modified>2025-11-19T04:17:32.825Z</last_modified>
  <evidence>Key findings for docs/stories/008.0-DEV-AUTO-FIX.story.md:

1) Traceability to Story 008.0
- `grep -R 008.0-DEV-AUTO-FIX .` shows references only in:
  - `docs/stories/008.0-DEV-AUTO-FIX.story.md`
  - `docs/stories/developer-story.map.md`
  - `.voder/traceability/docs-stories-008.0-DEV-AUTO-FIX.story.xml`
- No `@story docs/stories/008.0-DEV-AUTO-FIX.story.md` annotations appear in any `src` or `tests` files.
- No code or tests reference the REQ IDs from this story (`REQ-AUTOFIX-MISSING`, `REQ-AUTOFIX-FORMAT`, `REQ-AUTOFIX-SAFE`, `REQ-AUTOFIX-PRESERVE`, `REQ-AUTOFIX-TEMPLATE`, `REQ-AUTOFIX-SELECTIVE`).

2) Existing Auto-fix Implementations (tied to earlier stories)
- Missing @req on functions (003.0 story):
  - `src/rules/require-req-annotation.ts`:
    - `meta.fixable: "code"` (auto-fix enabled).
    - `create(context)` reports `missingReq` with an inline `fix(fixer) { return fixer.insertTextBefore(node, "/** @req <REQ-ID> */\n"); }` for `FunctionDeclaration`.
  - Tests: `tests/rules/require-req-annotation.test.ts`:
    - Invalid cases assert `output` with the inserted `/** @req <REQ-ID> */` and verify auto-fix behavior via ESLint RuleTester.
- Missing branch @story/@req (004.0 story):
  - `src/rules/require-branch-annotation.ts`:
    - `meta.fixable: "code"`.
    - Delegates to `reportMissingAnnotations` in `src/utils/branch-annotation-helpers.ts`.
  - `src/utils/branch-annotation-helpers.ts`:
    - `reportMissingStory` defines an `insertStoryFixer(fixer)` inserting `"${indent}// @story <story-file>.story.md\n"` before the branch.
    - `reportMissingReq` defines `insertReqFixer(fixer)` inserting `"${indent}// @req <REQ-ID>\n"`.
    - These fixers are used in `context.report({ ..., fix: insertStoryFixer })` / `fix: insertReqFixer` when safe.
  - Tests: `tests/rules/require-branch-annotation.test.ts` verify auto-fix `output` for many invalid cases (if/for/while/switch/try-catch), e.g.:
    - Missing annotations on `if (condition) {}` => output starts with `// @story <story-file>.story.md` and `// @req <REQ-ID>`.
- Auto-fix helpers for missing @story on functions (003.0 story):
  - `src/rules/helpers/require-story-core.ts`:
    - `createAddStoryFix(target)` returns a fixer that inserts `${ANNOTATION}\n` at the correct range.
    - `reportMissing(...)` uses `context.report({ ..., suggest: [{ desc: ..., fix: createAddStoryFix(resolvedTarget) }] })`.
  - `src/rules/helpers/require-story-helpers.ts` exports `ANNOTATION` as:
    - `const STORY_PATH = "docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md";`
    - `const ANNOTATION = `/** @story ${STORY_PATH} */`;`
  - Tests: `tests/rules/require-story-annotation.test.ts` and `tests/rules/require-story-core-edgecases.test.ts` / `tests/rules/require-story-core.autofix.test.ts` assert suggestion-based fixes and edge cases, but all are annotated with story 003.0 and generic `REQ-AUTOFIX`, not the REQ-AUTOFIX-* IDs from 008.0.

3) Behavior of require-story-annotation vs story 008.0 expectations
- `src/rules/require-story-annotation.ts`:
  - `meta`:
    - `hasSuggestions: true` but **no** `fixable` field.
    - Messages only define `missingStory`.
  - `create(context)` builds visitors and logs debug output, but **does not** expose a `fix` property in `meta` or top-level `context.report` calls.
- In ESLint, rules with only `suggest` entries (and no `meta.fixable`) do **not** execute those fixes on plain `eslint --fix`; they require `--fix-type suggestion` or editor-driven suggestion application.
- Story 008.0's core requirement is: "when I run ESLint with the --fix option"; this is not met for missing `@story` on functions, because that rule is suggestion-only.

4) No implementation of 008.0-specific requirements
- `REQ-AUTOFIX-MISSING`: Automatically add missing @story annotations to functions using template format
  - While there is a suggestion-based fixer (`createAddStoryFix`) inserting a hard-coded template `/** @story docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md */`, it is:
    - Tied to story 003.0 via `STORY_PATH` and annotations.
    - Exposed only as a **suggestion**, not an auto-fix triggered by `eslint --fix`.
    - Not traceably linked to `REQ-AUTOFIX-MISSING` or to story 008.0.
- `REQ-AUTOFIX-FORMAT`: Fix common annotation format issues (spacing, syntax, casing)
  - `src/rules/valid-annotation-format.ts` only reports `invalidStoryFormat` / `invalidReqFormat` and has **no `meta.fixable`** and no `fix` callbacks.
  - No rule automatically rewrites malformed annotation lines.
- `REQ-AUTOFIX-SAFE` and `REQ-AUTOFIX-PRESERVE`: safety and formatting preservation
  - Existing fixers insert placeholder comments/annotations but there is no logic (or tests) explicitly ensuring non-destructive behavior or preserving arbitrary existing formatting beyond basic indentation handling in branches.
  - No tests are tagged to REQ-AUTOFIX-SAFE or REQ-AUTOFIX-PRESERVE, and no configuration exists to limit or toggle risky fixes.
- `REQ-AUTOFIX-TEMPLATE`: Use configurable annotation templates for consistent formatting
  - Templates are hard-coded:
    - Functions: `ANNOTATION` constant for 003.0 story path.
    - Branches: string literals like `"// @story <story-file>.story.md\n"` and `"// @req <REQ-ID>\n"`.
  - No rule options or config mechanism exists to customize template text or placeholders.
- `REQ-AUTOFIX-SELECTIVE`: Allow developers to choose which types of fixes to enable/disable
  - `require-req-annotation` has no options at all.
  - `require-branch-annotation` has `branchTypes` to restrict node types, but nothing to enable/disable auto-fix behavior independently of detection.
  - No rule offers an option to, for example, enable format fixes but disable missing-annotation insertion.

5) Acceptance Criteria vs Current Implementation
- **Core Functionality**: "ESLint --fix automatically resolves common annotation violations"
  - Partially true for **some** earlier-scope violations (missing @req on functions; missing @story/@req on branches) but **not** for the core missing `@story`-on-function scenario described in this story, and not traceably tied to story 008.
- **Quality Standards** / **User Experience** / **Error Handling**:
  - There are tests ensuring branch and @req fixes produce expected output, but no tests for 008-specific REQ-AUTOFIX-* behaviors or for edge cases where fixes should be skipped.
- **Integration**:
  - Jest test run (`npm test -- --runInBand --verbose`) passes, so existing auto-fixes integrate with ESLint/Jest, but there is no coverage tied to story 008.
- **Documentation**:
  - Rule docs (`docs/rules/*.md`) describe behavior but do **not** mention auto-fix capabilities for annotation issues as a distinct feature, nor do they reference story 008.0 or its REQ-AUTOFIX-* requirements.

6) Test Execution
- Command executed: `npm test -- --runInBand --verbose`
- Jest runs with `--ci --bail --runInBand --verbose`; all tests pass.
- No test file header or `describe` block references `docs/stories/008.0-DEV-AUTO-FIX.story.md`; all auto-fix-related tests are attributed to 003.0 or 004.0 stories instead.
</evidence>
  <notes>This is a real, concrete story defining specific new auto-fix capabilities (REQ-AUTOFIX-MISSING/FORMAT/SAFE/PRESERVE/TEMPLATE/SELECTIVE). The project already has several auto-fix behaviors, but they are implemented and traced as part of earlier stories (003.0 function annotations, 004.0 branch annotations, 005.0 validation, 007.0 error reporting) and do not satisfy the full scope of 008.0:

- Missing @story on functions is only suggestion-fixable (not applied by plain `eslint --fix`), conflicting with the user story which targets `--fix`.
- There is no implementation or configuration for template-based, configurable annotation insertion (REQ-AUTOFIX-TEMPLATE) or selective enabling/disabling of fix types (REQ-AUTOFIX-SELECTIVE).
- Format-fixing of malformed annotations (REQ-AUTOFIX-FORMAT) is not implemented; the `valid-annotation-format` rule only validates.
- No code or tests are traceably linked to docs/stories/008.0-DEV-AUTO-FIX.story.md or its REQ-AUTOFIX-* IDs.
- Documentation does not describe 008.0-style auto-fix capabilities or provide examples tied to this story.

Because several explicit requirements and multiple acceptance criteria remain unimplemented or untested, this story is not fully delivered. Status: FAILED.</notes>
</traceability>