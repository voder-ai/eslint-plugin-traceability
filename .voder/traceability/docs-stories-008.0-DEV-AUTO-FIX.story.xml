<?xml version="1.0" encoding="UTF-8"?>
<traceability>
  <specification>docs/stories/008.0-DEV-AUTO-FIX.story.md</specification>
  <status>FAILED</status>
  <last_validated>2025-11-21T02:46:26.321Z</last_validated>
  <last_modified>2025-11-19T04:17:32.825Z</last_modified>
  <evidence>Story file:
- docs/stories/008.0-DEV-AUTO-FIX.story.md exists and clearly defines acceptance criteria and REQ-AUTOFIX-* requirements, but all acceptance-criteria checkboxes are unchecked ([ ]), indicating the authors do not consider it complete.

Function annotation auto-fix (require-story-annotation):
- src/rules/require-story-annotation.ts
  - meta:
    - type: "problem"
    - hasSuggestions: true
    - messages.missingStory defined
    - IMPORTANT: meta.fixable is NOT set, so ESLint will not apply fixes via --fix; only suggestions are offered.
  - create(context) delegates to buildVisitors and does not define any fix directly.
- src/rules/helpers/require-story-core.ts
  - Implements fixer helpers:
    - createAddStoryFix(target) uses fixer.insertTextBeforeRange([start, start], `${ANNOTATION}\n`).
    - createMethodFix(node) uses fixer.insertTextBeforeRange([start, start], `${ANNOTATION}\n  `).
    - ANNOTATION is a hard-coded template: `/** @story docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md */`.
  - JSDoc annotations in this file reference:
    - @story docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md
    - @req REQ-AUTOFIX - but this is tied to Story 003.0, not Story 008.0.
  - reportMissing(...) and reportMethod(...) use context.report with a suggest array, e.g.:
    - suggest: [{ desc: "Add JSDoc @story annotation for function 'name' ...", fix: createAddStoryFix(resolvedTarget) }].
- src/rules/helpers/require-story-helpers.ts
  - Imports createAddStoryFix and createMethodFix and wires them into reportMissing(...) and reportMethod(...), but only as suggestions (no rule-level fix, no meta.fixable).
- tests/rules/require-story-annotation.test.ts
  - Header: @story docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md; no mention of 008.0.
  - Invalid cases assert suggestions via an "errors" array with "suggestions" entries and explicit "output" fields, e.g. for missing @story on function bar:
    - errors: [{ messageId: "missingStory", suggestions: [{ desc: ..., output: "/** @story docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md */\nfunction bar() {}" }] }].
  - These tests confirm that suggestions produce certain outputs, but they do not validate ESLint --fix behavior, and they are tied to Story 003.0.
- tests/rules/require-story-core.autofix.test.ts
  - File header:
    - Tests for: docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md
    - @story docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md
    - @req REQ-AUTOFIX - Cover additional branch cases in require-story-core (addStoryFixer/reportMissing)
  - Tests only the helper behavior (createAddStoryFix, reportMissing with fallback sourceCode) and do not reference Story 008.0 or REQ-AUTOFIX-* IDs.

Branch annotation auto-fix (require-branch-annotation):
- src/rules/require-branch-annotation.ts
  - meta.fixable: "code" (this rule supports real ESLint auto-fix).
  - create(context) delegates to src/utils/branch-annotation-helpers.reportMissingAnnotations and returns listeners for configured branch types.
- src/utils/branch-annotation-helpers.ts
  - reportMissingStory(...) and reportMissingReq(...) define concrete fix functions:
    - insertStoryFixer(fixer) inserts `${indent}// @story <story-file>.story.md\n` before the branch.
    - insertReqFixer(fixer) inserts `${indent}// @req <REQ-ID>\n`.
  - context.report calls include a fix property (not just suggestions) when conditions are met (e.g., storyFixCountRef.count === 0 for @story).
  - JSDoc @story here references docs/stories/004.0-DEV-BRANCH-ANNOTATIONS.story.md; requirement tags are REQ-TRACEABILITY-* and REQ-ANNOTATION-PARSING, not REQ-AUTOFIX-* from Story 008.0.
- tests/rules/require-branch-annotation.test.ts
  - Header: @story docs/stories/004.0-DEV-BRANCH-ANNOTATIONS.story.md; no mention of 008.0.
  - Many invalid cases include an "output" property, verifying that ESLint auto-fix alters the code correctly. Examples:
    - Missing annotations on if-statement:
      - code: `if (condition) {}`
      - output: `// @story <story-file>.story.md\nif (condition) {}`
      - errors include messageId: "missingAnnotation" with data { missing: "@story" } and { missing: "@req" }.
    - Missing @req when only @story present, etc.
  - These tests confirm working auto-fix for branch annotations, but they are explicitly tied to Story 004.0 and do not cover Story 008.0's broader requirements (e.g., configurable templates, selective fix control).

Annotation format rule (valid-annotation-format) has no auto-fix:
- src/rules/valid-annotation-format.ts
  - Extensive validation and error-message building for @story/@req annotation formats.
  - meta: { type: "problem", docs, messages, schema: [] }.
  - NO meta.fixable and NO fix callbacks; a search for "fix" in this file found only "meta" but no fixer logic.
  - All context.report calls only specify messageId/data; none supply a fix or suggest property used for auto-fixing format issues.
- tests/rules/valid-annotation-format.test.ts
  - Header: @story docs/stories/005.0-DEV-ANNOTATION-VALIDATION.story.md.
  - Valid/invalid test cases verify that specific messageIds and data.details are reported, e.g. for missing or invalid story paths and req IDs.
  - No tests specify an "output" property, so there is no coverage of autofix behavior for format problems.

Traceability for Story 008.0:
- docs/stories/008.0-DEV-AUTO-FIX.story.md is present and clearly specifies requirements:
  - REQ-AUTOFIX-MISSING, REQ-AUTOFIX-FORMAT, REQ-AUTOFIX-SAFE, REQ-AUTOFIX-PRESERVE, REQ-AUTOFIX-TEMPLATE, REQ-AUTOFIX-SELECTIVE.
- Searches and inspections show:
  - src/rules/helpers/require-story-core.ts references a generic REQ-AUTOFIX (for Story 003.0), not the REQ-AUTOFIX-* IDs from Story 008.0.
  - src/utils/branch-annotation-helpers.ts has no REQ-AUTOFIX references; it uses different requirement IDs.
  - tests/rules/require-story-core.autofix.test.ts uses @req REQ-AUTOFIX but its @story header points to docs/stories/003.0-DEV-FUNCTION-ANNOTATIONS.story.md.
  - No test file or implementation file contains @story docs/stories/008.0-DEV-AUTO-FIX.story.md or any of REQ-AUTOFIX-MISSING / REQ-AUTOFIX-FORMAT / REQ-AUTOFIX-SAFE / REQ-AUTOFIX-PRESERVE / REQ-AUTOFIX-TEMPLATE / REQ-AUTOFIX-SELECTIVE.

Documentation:
- README.md lists rules and shows basic usage but does not describe auto-fix behavior, templates, or ESLint --fix integration.
- docs/rules/require-story-annotation.md and docs/rules/require-branch-annotation.md document rule purpose, options, and examples, but do not explain auto-fix capabilities or templates as required by Story 008.0.

Tests executed:
- `npm test -- --runInBand --verbose` ran successfully (Jest in CI mode). Output shows debug logs from require-story-annotation, confirming rules are active during tests. However, no tests are tagged with @story docs/stories/008.0-DEV-AUTO-FIX.story.md, and no tests explicitly validate the acceptance criteria of this story.</evidence>
  <notes>Story 008.0-DEV-AUTO-FIX is a concrete implementation specification, not just a planning note, so it must be evaluated against actual behavior.

What is implemented today:
- For functions, the plugin has helper-based autofix capability implemented as ESLint suggestions for missing @story annotations (createAddStoryFix, createMethodFix, reportMissing, reportMethod). These helpers insert a hard-coded annotation template for Story 003.0, and tests confirm that suggestions produce expected outputs. However, the main require-story-annotation rule does not declare meta.fixable or provide a direct fix property, so running ESLint with --fix will not automatically apply these suggestions by default. This falls short of the "ESLint --fix automatically resolves common annotation violations" requirement.
- For branch annotations, require-branch-annotation is fully fixable (meta.fixable: "code") with explicit fixer functions for inserting placeholder @story and @req comments. Tests verify before/after source code and confirm working auto-fix behavior, but this is scoped to Story 004.0 and focuses on branch annotations only.
- Annotation-format validation is implemented (Story 005.0) but is purely diagnostic: it emits detailed error messages without any auto-fix logic and without meta.fixable. Therefore it does not satisfy REQ-AUTOFIX-FORMAT or related requirements in Story 008.0.

Gaps relative to Story 008.0:
- Core Functionality: ESLint --fix does not currently auto-fix missing function annotations or annotation-format issues; only branch annotations are auto-fixed. Suggestions for functions exist but require manual selection in editors and are not wired into --fix.
- Requirements coverage:
  - REQ-AUTOFIX-MISSING: Partially covered for functions via suggestions (hard-coded template for Story 003.0) and fully covered for branches via placeholder comments, but not in a way that matches the story (configurable templates, explicit mapping to this story, and automatic --fix application).
  - REQ-AUTOFIX-FORMAT: Not implemented; valid-annotation-format only reports errors.
  - REQ-AUTOFIX-SAFE / REQ-AUTOFIX-PRESERVE: Some safety and indentation preservation exists (e.g., single story insertion per file for branches, indentation derived from source), but these behaviors are not designed, documented, or tested as a coherent safety/preservation strategy for this story.
  - REQ-AUTOFIX-TEMPLATE: Not implemented; templates are hard-coded and not configurable via rule options or plugin config.
  - REQ-AUTOFIX-SELECTIVE: Not implemented; existing options control what nodes are checked (scope, exportPriority, branchTypes) but do not allow enabling/disabling specific auto-fix categories.
- Traceability and tests: No implementation or test file references docs/stories/008.0-DEV-AUTO-FIX.story.md or the REQ-AUTOFIX-* IDs; all autofix-related code is tagged to earlier stories (003.0 and 004.0). No test suite explicitly verifies that running ESLint with --fix achieves the behavior described in this story.
- Documentation: Rule and user documentation do not describe auto-fix capabilities, examples of fixable issues, configuration for templates, or limitations of auto-fix as requested by this story.

Because several critical acceptance criteria and detailed requirements of 008.0-DEV-AUTO-FIX remain unimplemented (ESLint --fix for function and format issues, configurable and selective templates, explicit safety/format-preservation guarantees, and documentation/test coverage tied to this story), the story is not fully satisfied. The correct assessment status is FAILED.</notes>
</traceability>